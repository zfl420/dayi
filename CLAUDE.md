# 大姨 - 项目开发规范

---

# ⚠️ 强制执行规则 - 必读 ⚠️

## 🚨 代码修改必须遵循四步法流程 🚨

**这是强制性要求,不可跳过!**

当需要**修改代码或文件**时,**必须**按照以下流程执行:

1. ✅ **复述理解** - 用自己的话说明要做什么
2. ✅ **调用 AskUserQuestion 工具确认** - 必须调用工具,等待用户确认
3. ✅ **执行任务** - 确认后才能开始
4. ✅ **完成报告** - 说明完成了什么和如何验证

**❌ 禁止直接修改代码而跳过确认步骤!**
**❌ 禁止假设理解正确而不确认!**
**❌ 禁止"我理解了"之后直接开始写代码!**

**⚠️ 重要说明**:
- **回答问题时**: 直接回答,无需确认步骤
- **修改代码/文件时**: 必须执行完整的四步法流程

---

## 工作流程规范

### 代码修改的执行流程
**适用范围**: **所有代码和文件修改操作**（代码修改、功能开发、问题修复、代码恢复、文件操作等）

**不适用**: 回答问题、查询信息等非修改操作可直接回答

**执行流程**（四步法）:

1. **复述理解**
   - 用自己的话复述对需求的理解
   - 说明具体要做什么
   - 说明预期的结果

2. **调用确认工具**
   - 使用 AskUserQuestion 工具
   - 提供"是的,开始执行"和"不对,我重新说明"两个选项
   - 等待用户确认

3. **执行任务**
   - 确认无误后开始执行
   - 完成所有必要的操作

4. **完成报告**
   - 告知用户完成了什么
   - 说明如何检查结果
   - 提供验证方法

**代码修改示例**:
```
用户:"把按钮改成圆角"

助手:"我的理解:
- 将按钮的形状从方形改为圆角矩形
- 需要给 EditButton 添加 cornerRadius 修饰符
- 按钮边角会变成圆润的效果"

[调用 AskUserQuestion 工具]
- 选项1:是的,开始执行
- 选项2:不对,我重新说明

[用户确认后执行]

助手:"已完成:
- 在 HomeView.swift 第 435 行添加了 .cornerRadius() 修饰符
- 圆角半径设置为按钮高度的一半,形成完全圆角效果

如何检查:
- 在 Xcode 中运行 App
- 查看底部的按钮,边角应该是圆润的
- 可以对比修改前后的视觉效果"
```

---

## UI 设计规范

### 响应式设计
所有 UI 尺寸必须使用屏幕比例,而非固定像素值。

**基准设备**:iPhone 15 (393×852 pt)

**转换公式**:
- 垂直:`geometry.size.height * 比例值`
- 水平:`geometry.size.width * 比例值`
- 比例值 = 固定值 / 基准值(垂直852,水平393)

**代码编写规范**:
- **直接使用计算好的比例值**,不要在代码中写除法表达式
- 保留4位小数即可

**示例**:
```swift
// ❌ 错误
.padding(.top, 110)

// ❌ 错误 - 不要在代码中写除法
.padding(.top, geometry.size.height * (110.0 / 852.0))

// ✅ 正确 - 直接使用计算好的比例值
.padding(.top, geometry.size.height * 0.1291) // 日期标题顶部间距
```

---

## 代码注释规范

### 注释原则
注释应解释**语义和用途**,而非重复代码中已有的信息。

**严禁在注释中包含计算公式或数值**,只需描述用途。

**涉及到样式、显示的注释要打清晰点**,让人一眼就能理解这段代码的用途。

### ❌ 错误示例
```swift
// 4/852
.padding(.top, geometry.size.height * 0.0047)

// 角标字号 10/852
.font(.system(size: geometry.size.height * 0.0117))

// #FF5A7D
let color = Color(red: 255/255, green: 90/255, blue: 125/255)

// 39.84/852,介于44和35.78之间
.frame(height: geometry.size.height * 0.0468)

// 按钮高度 44
.frame(height: geometry.size.height * 0.0516)
```

**问题**:
- 包含计算比例 `4/852`、`10/852`
- 包含像素值 `44`
- 包含颜色代码 `#FF5A7D`
- 包含冗余计算说明 `介于44和35.78之间`

### ✅ 正确示例
```swift
// 文案行间距
.padding(.top, geometry.size.height * 0.0047)

// 角标字号
.font(.system(size: geometry.size.height * 0.0117))

// 经期中状态的主题色
let color = Color(red: 255/255, green: 90/255, blue: 125/255)

// 按钮高度
.frame(height: geometry.size.height * 0.0468)

// 记录按钮高度
.frame(height: geometry.size.height * 0.0516)
```

### 注释内容要求
- **组件/区域**:说明这是什么UI元素(如:日期标题、周历区域、编辑按钮)
- **颜色**:说明颜色的用途(如:选中状态背景色、经期中状态的主题色),**禁止写颜色代码**
- **间距/尺寸**:说明间距或尺寸的作用(如:按钮与文案间距、角标字号),**禁止写计算公式或像素值**
- **状态/逻辑**:说明判断条件的业务含义(如:判断是否在经期内、检查是否有历史记录)

---

## 代码修改原则

### 1. 性能优化(可直接执行)
不改变业务逻辑的优化:
- 使用 LazyVStack/LazyHStack
- 优化算法和计算
- 减少重复渲染
- 代码结构重构

### 2. 逻辑修改(必须先确认)
任何改变业务行为的修改:
- 修改日期范围、数据来源
- 调整默认值、初始状态
- 修改 UI 行为
- 功能增删

**原则**:
- 不确定时,先询问用户
- 提供多个方案供选择
- 获得明确同意后再执行
- **所有操作都遵循统一的任务执行流程（四步法）**

---

## iOS 原生实现优先原则

### 强制要求
**必须优先使用 iOS 标准的原生实现方式**

### 执行规则

1. **优先级顺序**:
   - 第一优先: 使用 SwiftUI/UIKit 的标准原生 API
   - 第二优先: 使用苹果官方推荐的实现方式
   - 最后选择: 自定义实现

2. **遇到实现困难时**:
   - ❌ **禁止**自己决定使用非原生方式
   - ✅ **必须**先尝试原生实现
   - ✅ **必须**告知用户原生方式的限制
   - ✅ **必须**提供多个方案让用户选择

3. **告知用户的内容**:
   - 原生方式能实现什么
   - 原生方式有什么限制
   - 如果使用自定义方式的优缺点
   - 让用户做最终决定

### 示例

**❌ 错误做法**:
```
用户: "实现侧滑返回"
助手: [直接使用自定义手势实现,没有告知原生方式]
```

**✅ 正确做法**:
```
用户: "实现侧滑返回"
助手: "我发现有两种实现方式:

1. 原生方式 (推荐):
   - 使用 NavigationStack + NavigationLink
   - 自动支持侧滑返回手势
   - 但需要使用 .toolbar(.hidden) 而非 .navigationBarHidden

2. 自定义方式:
   - 完全自己实现手势
   - 可以完全控制动画
   - 但需要更多代码,可能有兼容性问题

建议使用原生方式,您觉得如何?"
```

### 适用场景
- 导航和页面转场
- 手势交互
- 动画效果
- UI 组件
- 数据持久化
- 网络请求
- 所有 iOS 平台功能

---

## 构建规则

**禁止自动构建**:
- 禁止自动执行 `xcodebuild` 构建命令
- 禁止在修改代码后自动验证编译
- 只在用户明确要求时才执行构建操作
- 用户会在 Xcode IDE 中自行验证和测试
