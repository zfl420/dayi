# 页面结构与功能说明

## 页面结构
- `HomeView`（首页）
  - 日期标题
  - 周历组件
  - 经期状态轮播与状态背景
  - 编辑月经日期按钮
  - 我的月经周期信息区
- `CycleStatsView`（周期天数统计）
  - 周期天数统计头部
  - 当前周期卡片
  - 历史周期列表
  - 平均值参考线
- `PeriodLengthStatsView`（经期天数统计）
  - 经期天数统计头部
  - 当前经期卡片
  - 历史经期列表
  - 平均值参考线
- `CalendarView`（日历页）
  - 月历滚动内容
  - 星期标题
  - 月份标题与日期网格（含经期/预测经期背景）
  - 右上角切换按钮（月视图/年视图）
  - 年视图（年份标题 + 12 个月小月历）
  - 空状态（无经期月份时提示“记录你上一次经期开始的日期”并提供“记录月经”按钮）
- `DatePickerFullScreenContent`（日期选择全屏页）
  - 日期选择内容区
  - 底部工具栏（取消/今天/保存）

## 页面功能说明
- `HomeView`：展示当前日期与周历，经期状态可通过左右滑动切换日期，支持记录/编辑经期信息，并展示“我的月经周期”摘要。
- `CycleStatsView`：展示周期天数统计数据，包括当前周期、历史周期与平均参考线。
- `PeriodLengthStatsView`：展示经期天数统计数据，包括当前经期、历史经期与平均参考线。
- `CalendarView`：默认进入年视图，支持月视图与年视图切换，仅展示包含经期/预测经期的月份；无记录时展示空状态并引导记录月经。

## 隐藏状态记录要求
当页面存在“条件触发、非默认可见”的隐藏状态（例如空状态、无数据提示、异常提示等）时，必须在本文件中明确记录触发条件与展示内容，确保文档覆盖所有可见状态。
- `DatePickerFullScreenContent`：用于记录/编辑经期日期，支持多选与自动预测，保存后写入经期记录。

## 页面入口与导航流转
- App 启动入口：`DayiApp` -> `HomeView`
- `HomeView` 右上角日历图标 -> `CalendarView`
- `HomeView` 编辑按钮 -> `DatePickerFullScreenContent`
- `HomeView`「我的月经周期」卡片 -> `CycleStatsView` / `PeriodLengthStatsView`

## 页面对应的 ViewModel
- `HomeView`：`PeriodViewModel`（页面内创建并持有）
- `CycleStatsView`：`PeriodViewModel`（由 `HomeView` 传入）
- `PeriodLengthStatsView`：`PeriodViewModel`（由 `HomeView` 传入）
- `DatePickerFullScreenContent`：`PeriodViewModel`（由 `HomeView` 传入）
- `CalendarView`：`PeriodViewModel`（由 `HomeView` 传入）

## 关键组件与数据来源
- 首页周历与经期状态：`WeekCalendar`、`PeriodStatusCarousel` 依赖 `PeriodViewModel.selectedDate`、`currentWeekDates` 与 `getDateStatus`
- 我的月经周期信息区：`MenstrualCycleInfo` 使用 `completedCycles` 计算上次周期与范围
- 周期天数统计页：`CycleStatsView` 读取 `averageCycleDays`、`maxCycleDays`、`completedCycles`、`currentCycle`
- 经期天数统计页：`PeriodLengthStatsView` 读取 `averagePeriodDays`、`maxPeriodDays`、`historicalPeriods`、`currentPeriod`
- 日期选择器：`DatePickerContent` 使用 `tempSelectedDates` 与 `getStateForDatePicker` 渲染状态，并通过 `loadDatePickerData` 与 `scrollToToday` 管理可见区
- 数据持久化：`PeriodViewModel` 通过 `UserDefaults(periodRecords_v2)` 保存/读取经期记录

## 主要交互与状态变化
- `HomeView` 左右滑动切换日期：更新 `selectedDate`、`carouselBaseDate` 与背景经期比例
- 周历点击切换选中日期：联动状态轮播与背景显示
- 点击“记录月经/编辑月经日期”：进入日期选择页并触发 `openDatePicker`，加载已选日期
- 日期选择器内多选日期：更新 `tempSelectedDates`，必要时自动预测连续日期
- 工具栏操作：取消关闭不保存；“今天”滚动到底部；保存调用 `savePeriodRecords` 并写入持久化

## 页面文档同步规则

当新增或拆分页面时（例如在 `Dayi/Dayi/Views/` 下新增页面视图文件），必须同步更新本文件，确保项目文档始终覆盖全部页面，便于团队沟通。
